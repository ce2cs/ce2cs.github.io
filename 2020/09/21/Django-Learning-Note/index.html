<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Django Model LayerReference: https:&#x2F;&#x2F;www.liujiangblog.com&#x2F;course&#x2F;django&#x2F;95 Important Fields   Fields Descript    BooleanField A true&#x2F;false field.   CharField A string field, for small- to large-sized">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Learning Note">
<meta property="og:url" content="http://yoursite.com/2020/09/21/Django-Learning-Note/index.html">
<meta property="og:site_name" content="Boyang&#39;s Personal Blog">
<meta property="og:description" content="Django Model LayerReference: https:&#x2F;&#x2F;www.liujiangblog.com&#x2F;course&#x2F;django&#x2F;95 Important Fields   Fields Descript    BooleanField A true&#x2F;false field.   CharField A string field, for small- to large-sized">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-21T01:33:45.000Z">
<meta property="article:modified_time" content="2020-09-21T01:36:47.897Z">
<meta property="article:author" content="Boyang Gao">
<meta property="article:tag" content="Learning Note">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/09/21/Django-Learning-Note/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Django Learning Note | Boyang's Personal Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Boyang's Personal Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/21/Django-Learning-Note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Boyang Gao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Boyang's Personal Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Django Learning Note
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-09-21 09:33:45 / Modified: 09:36:47" itemprop="dateCreated datePublished" datetime="2020-09-21T09:33:45+08:00">2020-09-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Django-Model-Layer"><a href="#Django-Model-Layer" class="headerlink" title="Django Model Layer"></a>Django Model Layer</h1><p>Reference: <a target="_blank" rel="noopener" href="https://www.liujiangblog.com/course/django/95">https://www.liujiangblog.com/course/django/95</a></p>
<h2 id="Important-Fields"><a href="#Important-Fields" class="headerlink" title="Important Fields"></a>Important Fields</h2><table>
<thead>
<tr>
<th>Fields</th>
<th>Descript</th>
</tr>
</thead>
<tbody><tr>
<td>BooleanField</td>
<td>A true/false field.</td>
</tr>
<tr>
<td>CharField</td>
<td>A string field, for small- to large-sized strings.</td>
</tr>
<tr>
<td>DateField</td>
<td>A date, represented in Python by a <code>datetime.date</code> instance.</td>
</tr>
<tr>
<td>EmailField</td>
<td>A <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/ref/models/fields/#django.db.models.CharField"><code>CharField</code></a> that checks that the value is a valid email address using <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/ref/validators/#django.core.validators.EmailValidator"><code>EmailValidator</code></a>.</td>
</tr>
<tr>
<td>FileField</td>
<td>A file-upload field.</td>
</tr>
<tr>
<td>ImageField</td>
<td>nherits all attributes and methods from <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/ref/models/fields/#django.db.models.FileField"><code>FileField</code></a>, but also validates that the uploaded object is a valid image.</td>
</tr>
<tr>
<td>IntegerField</td>
<td>An integer. Values from <code>-2147483648</code> to <code>2147483647</code> are safe in all databases supported by Django.</td>
</tr>
<tr>
<td>GenericIPAddressField</td>
<td>An IPv4 or IPv6 address, in string format (e.g. <code>192.0.2.30</code> or <code>2a02:42fe::4</code>). The default form widget for this field is a <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/3.1/ref/forms/widgets/#django.forms.TextInput"><code>TextInput</code></a>.</td>
</tr>
<tr>
<td>TextField</td>
<td>A large text field.</td>
</tr>
</tbody></table>
<h2 id="The-Difference-between-null-and-blank"><a href="#The-Difference-between-null-and-blank" class="headerlink" title="The Difference between null and blank"></a>The Difference between null and blank</h2><table>
<thead>
<tr>
<th align="left">Field 类型</th>
<th align="left">设置null=True</th>
<th align="left">设置blank=True</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CharField, TextField, SlugField, EmailField, CommaSeparatedIntegerField等</td>
<td align="left">不要设置 django规定储存空字符串来代表空值, 当从数据库中读取NULL或空值时都为空字符串</td>
<td align="left">可以设置 设置后允许接受widget中为空值(即不填写), 储存到数据库时空值变为空字符串</td>
</tr>
<tr>
<td align="left">FileField, ImageField</td>
<td align="left">不要设置 django实际储存的是路径的字符串, 因此同上</td>
<td align="left">可以设置 同上</td>
</tr>
<tr>
<td align="left">BooleanField</td>
<td align="left">不要设置 因为有NullBooleanField代替</td>
<td align="left">不要设置</td>
</tr>
<tr>
<td align="left">IntegerField, FloatField, DecimalField等</td>
<td align="left">可以设置 如果你希望在数据库中能储存NULL</td>
<td align="left">可以设置 设置后允许接受widget中为空值(即不填写), 设置为True时必须同时设置null=True</td>
</tr>
<tr>
<td align="left">DateTimeField, DateField, TimeField等</td>
<td align="left">可以设置 如果你希望在数据库中能储存NULL</td>
<td align="left">可以设置 设置后允许接受widget中为空值(即不填写), 设置为True时必须同时设置null=True</td>
</tr>
<tr>
<td align="left">ForeignKey, ManyToManyField, OneToOneField</td>
<td align="left">可以设置 如果你希望在数据库中能储存NULL</td>
<td align="left">可以设置 设置后允许接受widget中为空值(即不填写)</td>
</tr>
<tr>
<td align="left">GenericIPAddressField</td>
<td align="left">可以设置 如果你希望在数据库中能储存NULL</td>
<td align="left">可以设置 设置后允许接受widget中为空值(即不填写)</td>
</tr>
<tr>
<td align="left">IPAddressField</td>
<td align="left">不推荐设置 用GenericIPAddressField代替</td>
<td align="left">不推荐设置 用GenericIPAddressField代替</td>
</tr>
</tbody></table>
<h2 id="Index-Definition-and-Example"><a href="#Index-Definition-and-Example" class="headerlink" title="Index Definition and Example"></a>Index Definition and Example</h2><p>索引用于快速找出在某个列中有一特定值的行，不使用索引，MySQL必须从第一条记录开始读完整个表，直到找出相关的行，表越大，查询数据所花费的时间就越多，如果表中查询的列有一个索引，MySQL能够快速到达一个位置去搜索数据文件，而不必查看所有数据，那么将会节省很大一部分时间。</p>
<p>例如：有一张person表，其中有2W条记录，记录着2W个人的信息。有一个Phone的字段记录每个人的电话号码，现在想要查询出电话号码为xxxx的人的信息。如果没有索引，那么将从表中第一条记录一条条往下遍历，直到找到该条信息为止。如果有了索引，那么会将该Phone字段，通过一定的方法进行存储，好让查询该字段上的信息时，能够快速找到对应的数据，而不必在遍历2W条数据了。<strong>其中**</strong>MySQL**<strong>中的索引的存储类型有两种：**</strong>BTREE**<strong>、**</strong>HASH**。 也就是用树或者Hash值来存储该字段，要知道其中详细是如何查找的，就需要会算法的知识了。我们现在只需要知道索引的作用，功能是什么就行。</p>
<p>作者：不屈真实<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0d6c828d3c70">https://www.jianshu.com/p/0d6c828d3c70</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h2 id="Meta"><a href="#Meta" class="headerlink" title="Meta"></a>Meta</h2><p>模型的元数据，指的是“除了字段外的所有内容”，例如排序方式、数据库表名、人类可读的单数或者复数名等等。所有的这些都是非必须的，甚至元数据本身对模型也是非必须的。但是，我要说但是，有些元数据选项能给予你极大的帮助，在实际使用中具有重要的作用，是实际应用的‘必须’。</p>
<h3 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h3><p>如果<code>abstract=True</code>，那么模型会被认为是一个抽象模型。抽象模型本身不实际生成数据库表，而是作为其它模型的父类，被继承使用。具体内容可以参考Django模型的继承。</p>
<h3 id="ordering"><a href="#ordering" class="headerlink" title="ordering"></a>ordering</h3><p>最常用的元数据之一了！</p>
<p>用于指定该模型生成的所有对象的排序方式，接收一个字段名组成的元组或列表。默认按升序排列，如果在字段名前加上字符“-”则表示按降序排列，如果使用字符问号“？”表示随机排列。请看下面的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ordering &#x3D; [&#39;pub_date&#39;]             # 表示按&#39;pub_date&#39;字段进行升序排列</span><br><span class="line">ordering &#x3D; [&#39;-pub_date&#39;]            # 表示按&#39;pub_date&#39;字段进行降序排列</span><br><span class="line">ordering &#x3D; [&#39;-pub_date&#39;, &#39;author&#39;]  # 表示先按&#39;pub_date&#39;字段进行降序排列，再按&#96;author&#96;字段进行升序排列。</span><br></pre></td></tr></table></figure>

<h3 id="unique-together"><a href="#unique-together" class="headerlink" title="unique_together"></a>unique_together</h3><p>这个元数据是非常重要的一个！它等同于数据库的联合约束！</p>
<p>举个例子，假设有一张用户表，保存有用户的姓名、出生日期、性别和籍贯等等信息。要求是所有的用户唯一不重复，可现在有好几个叫“张伟”的，如何区别它们呢？（不要和我说主键唯一，这里讨论的不是这个问题）</p>
<p>我们可以设置不能有两个用户在同一个地方同一时刻出生并且都叫“张伟”，使用这种联合约束，保证数据库能不能重复添加用户（也不要和我谈小概率问题）。在Django的模型中，如何实现这种约束呢？</p>
<p>使用<code>unique_together</code>，也就是联合唯一！</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unique_together &#x3D; ((&#39;name&#39;, &#39;birth_day&#39;, &#39;address&#39;),)</span><br></pre></td></tr></table></figure>

<p>这样，哪怕有两个在同一天出生的张伟，但他们的籍贯不同，也就是两个不同的用户。一旦三者都相同，则会被Django拒绝创建。这一元数据经常被用在admin后台，并且强制应用于数据库层面。</p>
<p>unique_together接收一个二维的元组((xx,xx,xx,…),(),(),()…)，每一个元素都是一个元组，表示一组联合唯一约束，可以同时设置多组约束。为了方便，对于只有一组约束的情况下，可以简单地使用一维元素，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unique_together &#x3D; (&#39;name&#39;, &#39;birth_day&#39;, &#39;address&#39;)</span><br></pre></td></tr></table></figure>

<p>联合唯一无法作用于普通的多对多字段。</p>
<h3 id="verbose-name"><a href="#verbose-name" class="headerlink" title="verbose_name"></a>verbose_name</h3><p>最常用的元数据之一！用于设置模型对象的直观、人类可读的名称。可以用中文。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">verbose_name &#x3D; &quot;story&quot;</span><br><span class="line">verbose_name &#x3D; &quot;披萨&quot;</span><br></pre></td></tr></table></figure>

<p>如果你不指定它，那么Django会使用小写的模型名作为默认值。</p>
<h3 id="Differences-between-related-nameand-related-query-name"><a href="#Differences-between-related-nameand-related-query-name" class="headerlink" title="Differences between related_nameand related_query_name"></a>Differences between <code>related_name</code>and <code>related_query_name</code></h3><p><code>related_name</code> will be the attribute of the related object that allows you to go ‘backwards’ to the model with the foreign key on it. For example, if <code>ModelA</code> has a field like: <code>model_b = ForeignKeyField(ModelB, related_name=&#39;model_as&#39;)</code>, this would enable you to access the <code>ModelA</code> instances that are related to your <code>ModelB</code> instance by going <code>model_b_instance.model_as.all()</code>. Note that this is generally written with a plural for a Foreign Key, because a foreign key is a one to many relationship, and the many side of that equation is the model with the Foreign Key field declared on it.</p>
<p><code>related_query_name</code> is for use in Django querysets. It allows you to filter on the reverse relationship of a foreign key related field. To continue our example - having a field on <code>Model A</code> like: <code>model_b = ForeignKeyField(ModelB, related_query_name=&#39;model_a&#39;)</code> would enable you to use <code>model_a</code> as a lookup parameter in a queryset, like: <code>ModelB.objects.filter(model_a=whatever)</code>. It is more common to use a singular form for the <code>related_query_name</code>. As the docs say, it isn’t necessary to specify both (or either of) <code>related_name</code> and <code>related_query_name</code>. Django has sensible defaults.</p>
<p>Reference: <a target="_blank" rel="noopener" href="https://stackoverrun.com/cn/q/11861228">https://stackoverrun.com/cn/q/11861228</a></p>
<h3 id="多表继承"><a href="#多表继承" class="headerlink" title="多表继承"></a>多表继承</h3><ul>
<li>抽象表-继承除了abstract的元</li>
<li>实际表-不继承元</li>
</ul>
<h3 id="Proxy-Model"><a href="#Proxy-Model" class="headerlink" title="Proxy Model"></a>Proxy Model</h3><p>使用多表继承时，父类的每个子类都会创建一张新数据表，通常情况下，这是我们想要的操作，因为子类需要一个空间来存储不包含在父类中的数据。但有时，你可能只想更改模型在Python层面的行为，比如更改默认的manager管理器，或者添加一个新方法。</p>
<p>代理模型就是为此而生的。你可以创建、删除、更新代理模型的实例，并且所有的数据都可以像使用原始模型（非代理类模型）一样被保存。不同之处在于你可以在代理模型中改变默认的排序方式和默认的manager管理器等等，而不会对原始模型产生影响。</p>
<p><strong>声明一个代理模型只需要将Meta中proxy的值设为True。</strong></p>
<p>例如你想给Person模型添加一个方法。你可以这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Person(models.Model):</span><br><span class="line">    first_name &#x3D; models.CharField(max_length&#x3D;30)</span><br><span class="line">    last_name &#x3D; models.CharField(max_length&#x3D;30)</span><br><span class="line"></span><br><span class="line">class MyPerson(Person):</span><br><span class="line">    class Meta:</span><br><span class="line">        proxy &#x3D; True</span><br><span class="line"></span><br><span class="line">    def do_something(self):</span><br><span class="line">        # ...</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<p>MyPerson类将操作和Person类同一张数据库表。并且任何新的Person实例都可以通过MyPerson类进行访问，反之亦然。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p &#x3D; Person.objects.create(first_name&#x3D;&quot;foobar&quot;)</span><br><span class="line">&gt;&gt;&gt; MyPerson.objects.get(first_name&#x3D;&quot;foobar&quot;)</span><br><span class="line">&lt;MyPerson: foobar&gt;</span><br></pre></td></tr></table></figure>

<p>下面的例子通过代理进行排序，但父类却不排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class OrderedPerson(Person):</span><br><span class="line">    class Meta:</span><br><span class="line">        # 现在，普通的Person查询是无序的，而OrderedPerson查询会按照&#96;last_name&#96;排序。</span><br><span class="line">        ordering &#x3D; [&quot;last_name&quot;]</span><br><span class="line">        proxy &#x3D; True</span><br></pre></td></tr></table></figure>

<p><strong>一些约束：</strong></p>
<ul>
<li>代理模型必须继承自一个非抽象的基类，并且不能同时继承多个非抽象基类；</li>
<li>代理模型可以同时继承任意多个抽象基类，前提是这些抽象基类没有定义任何模型字段。</li>
<li>代理模型可以同时继承多个别的代理模型，前提是这些代理模型继承同一个非抽象基类。（早期Django版本不支持这一条）</li>
</ul>
<h3 id="Save-Foreign-Key-and-Many-to-Many-Field"><a href="#Save-Foreign-Key-and-Many-to-Many-Field" class="headerlink" title="Save Foreign Key and Many to Many Field"></a>Save Foreign Key and Many to Many Field</h3><p>保存一个外键字段和保存普通字段没什么区别，只是要注意值的类型要正确。下面的例子，有一个Entry的实例entry和一个Blog的实例<code>cheese_blog</code>，然后把<code>cheese_blog</code>作为值赋给了entry的blog属性，最后调用save方法进行保存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from blog.models import Entry</span><br><span class="line">&gt;&gt;&gt; entry &#x3D; Entry.objects.get(pk&#x3D;1)</span><br><span class="line">&gt;&gt;&gt; cheese_blog &#x3D; Blog.objects.get(name&#x3D;&quot;Cheddar Talk&quot;)</span><br><span class="line">&gt;&gt;&gt; entry.blog &#x3D; cheese_blog</span><br><span class="line">&gt;&gt;&gt; entry.save()</span><br></pre></td></tr></table></figure>

<p>多对多字段的保存稍微有点区别，需要调用一个<code>add()</code>方法，而不是直接给属性赋值，但它不需要调用save方法。如下例所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from blog.models import Author</span><br><span class="line">&gt;&gt;&gt; joe &#x3D; Author.objects.create(name&#x3D;&quot;Joe&quot;)</span><br><span class="line">&gt;&gt;&gt; entry.authors.add(joe)</span><br></pre></td></tr></table></figure>

<p>在一行语句内，可以同时添加多个对象到多对多的字段，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; john &#x3D; Author.objects.create(name&#x3D;&quot;John&quot;)</span><br><span class="line">&gt;&gt;&gt; paul &#x3D; Author.objects.create(name&#x3D;&quot;Paul&quot;)</span><br><span class="line">&gt;&gt;&gt; george &#x3D; Author.objects.create(name&#x3D;&quot;George&quot;)</span><br><span class="line">&gt;&gt;&gt; ringo &#x3D; Author.objects.create(name&#x3D;&quot;Ringo&quot;)</span><br><span class="line">&gt;&gt;&gt; entry.authors.add(john, paul, george, ringo)</span><br></pre></td></tr></table></figure>

<p>如果你指定或添加了错误类型的对象，Django会抛出异常。</p>
<h3 id="字段查询"><a href="#字段查询" class="headerlink" title="字段查询"></a>字段查询</h3><p>字段查询其实就是filter()、exclude()和get()等方法的关键字参数。 其基本格式是：<code>field__lookuptype=value</code>，<strong>注意其中是双下划线</strong>。 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Entry.objects.filter(pub_date__lte&#x3D;&#39;2006-01-01&#39;)</span><br><span class="line">#　相当于：</span><br><span class="line">SELECT * FROM blog_entry WHERE pub_date &lt;&#x3D; &#39;2006-01-01&#39;;</span><br></pre></td></tr></table></figure>

<p>其中的字段必须是模型中定义的字段之一。但是有一个例外，那就是ForeignKey字段，你可以为其添加一个“_id”后缀（单下划线）。这种情况下键值是外键模型的主键原生值。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Entry.objects.filter(blog_id&#x3D;4)</span><br></pre></td></tr></table></figure>

<p>如果你传递了一个非法的键值，查询函数会抛出TypeError异常。</p>
<p>Django的数据库API支持20多种查询类型，下面介绍一些常用的：</p>
<p><strong>exact：</strong></p>
<p>默认类型。如果你不提供查询类型，或者关键字参数不包含一个双下划线，那么查询类型就是这个默认的exact。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Entry.objects.get(headline__exact&#x3D;&quot;Cat bites dog&quot;)</span><br><span class="line"># 相当于</span><br><span class="line"># SELECT ... WHERE headline &#x3D; &#39;Cat bites dog&#39;;</span><br><span class="line"># 下面两个相当</span><br><span class="line">&gt;&gt;&gt; Blog.objects.get(id__exact&#x3D;14)  # Explicit form</span><br><span class="line">&gt;&gt;&gt; Blog.objects.get(id&#x3D;14)         # __exact is implied</span><br></pre></td></tr></table></figure>

<p><strong>iexact：</strong></p>
<p>不区分大小写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Blog.objects.get(name__iexact&#x3D;&quot;beatles blog&quot;)</span><br><span class="line"># 匹配&quot;Beatles Blog&quot;, &quot;beatles blog&quot;,甚至&quot;BeAtlES blOG&quot;.</span><br></pre></td></tr></table></figure>

<p><strong>contains：</strong></p>
<p>表示包含的意思！大小写敏感！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.get(headline__contains&#x3D;&#39;Lennon&#39;)</span><br><span class="line"># 相当于</span><br><span class="line"># SELECT ... WHERE headline LIKE &#39;%Lennon%&#39;;</span><br><span class="line"># 匹配&#39;Today Lennon honored&#39;，但不匹配&#39;today lennon honored&#39;</span><br></pre></td></tr></table></figure>

<p><strong>icontains：</strong></p>
<p>contains的大小写不敏感模式。</p>
<p><strong>startswith和endswith</strong></p>
<p>以什么开头和以什么结尾。大小写敏感！</p>
<p><strong>istartswith和iendswith</strong></p>
<p>是不区分大小写的模式。</p>
<h3 id="使用Q对象进行复杂查询"><a href="#使用Q对象进行复杂查询" class="headerlink" title="使用Q对象进行复杂查询"></a>使用Q对象进行复杂查询</h3><p>普通filter函数里的条件都是“and”逻辑，如果你想实现“or”逻辑怎么办？用Q查询！</p>
<p>Q来自<code>django.db.models.Q</code>，用于封装关键字参数的集合，可以作为关键字参数用于filter、exclude和get等函数。 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Q</span><br><span class="line">Q(question__startswith&#x3D;&#39;What&#39;)</span><br></pre></td></tr></table></figure>

<p>可以使用“&amp;”或者“|”或“~”来组合Q对象，分别表示与或非逻辑。它将返回一个新的Q对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Q(question__startswith&#x3D;&#39;Who&#39;)|Q(question__startswith&#x3D;&#39;What&#39;)</span><br><span class="line"># 这相当于：</span><br><span class="line">WHERE question LIKE &#39;Who%&#39; OR question LIKE &#39;What%&#39;</span><br></pre></td></tr></table></figure>

<p>更多的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q(question__startswith&#x3D;&#39;Who&#39;) | ~Q(pub_date__year&#x3D;2005)</span><br></pre></td></tr></table></figure>

<p>你也可以这么使用，默认情况下，以逗号分隔的都表示AND关系：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">Q(question__startswith&#x3D;&#39;Who&#39;),</span><br><span class="line">Q(pub_date&#x3D;date(2005, 5, 2)) | Q(pub_date&#x3D;date(2005, 5, 6))</span><br><span class="line">)</span><br><span class="line"># 它相当于</span><br><span class="line"># SELECT * from polls WHERE question LIKE &#39;Who%&#39;</span><br><span class="line">AND (pub_date &#x3D; &#39;2005-05-02&#39; OR pub_date &#x3D; &#39;2005-05-06&#39;)</span><br></pre></td></tr></table></figure>

<p>当关键字参数和Q对象组合使用时，Q对象必须放在前面，如下例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">Q(pub_date&#x3D;date(2005, 5, 2)) | Q(pub_date&#x3D;date(2005, 5, 6)),question__startswith&#x3D;&#39;Who&#39;,)</span><br></pre></td></tr></table></figure>

<p>如果关键字参数放在Q对象的前面，则会报错。</p>
<h3 id="批量更新对象"><a href="#批量更新对象" class="headerlink" title="批量更新对象"></a>批量更新对象</h3><p>使用<code>update()</code>方法可以批量为QuerySet中所有的对象进行更新操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 更新所有2007年发布的entry的headline</span><br><span class="line">Entry.objects.filter(pub_date__year&#x3D;2007).update(headline&#x3D;&#39;Everything is the same&#39;)</span><br></pre></td></tr></table></figure>

<p>只可以对普通字段和ForeignKey字段使用这个方法。若要更新一个普通字段，只需提供一个新的常数值。若要更新ForeignKey字段，需设置新值为你想指向的新模型实例。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b &#x3D; Blog.objects.get(pk&#x3D;1)</span><br><span class="line"># 修改所有的Entry，让他们都属于b</span><br><span class="line">&gt;&gt;&gt; Entry.objects.all().update(blog&#x3D;b)</span><br></pre></td></tr></table></figure>

<p>update方法会被立刻执行，并返回操作匹配到的行的数目（有可能不等于要更新的行的数量，因为有些行可能已经有这个新值了）。唯一的约束是：只能访问一张数据库表。你可以根据关系字段进行过滤，但你只能更新模型主表的字段。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b &#x3D; Blog.objects.get(pk&#x3D;1)</span><br><span class="line"># Update all the headlines belonging to this Blog.</span><br><span class="line">&gt;&gt;&gt; Entry.objects.select_related().filter(blog&#x3D;b).update(headline&#x3D;&#39;Everything is the same&#39;)</span><br></pre></td></tr></table></figure>

<p>要注意的是update()方法会直接转换成一个SQL语句，并立刻批量执行。它不会运行模型的save()方法，或者产生<code>pre_save</code>或<code>post_save</code>信号（调用<code>save()</code>方法产生）或者服从<code>auto_now</code>字段选项。如果你想保存QuerySet中的每个条目并确保每个实例的save()方法都被调用，你不需要使用任何特殊的函数来处理。只需要迭代它们并调用save()方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for item in my_queryset:</span><br><span class="line">    item.save()</span><br></pre></td></tr></table></figure>

<p>update方法可以配合F表达式。这对于批量更新同一模型中某个字段特别有用。例如增加Blog中每个Entry的pingback个数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Entry.objects.all().update(n_pingbacks&#x3D;F(&#39;n_pingbacks&#39;) + 1)</span><br></pre></td></tr></table></figure>

<p>然而，与filter和exclude子句中的F()对象不同，在update中你不可以使用F()对象进行跨表操作，你只可以引用正在更新的模型的字段。如果你尝试使用F()对象引入另外一张表的字段，将抛出FieldError异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># THIS WILL RAISE A FieldError</span><br><span class="line">&gt;&gt;&gt; Entry.objects.update(headline&#x3D;F(&#39;blog__name&#39;))</span><br></pre></td></tr></table></figure>

<h3 id="QuerySet-API"><a href="#QuerySet-API" class="headerlink" title="QuerySet API"></a>QuerySet API</h3><h4 id="annotate"><a href="#annotate" class="headerlink" title="annotate()"></a>annotate()</h4><p>annotate(<em>args,</em> *kwargs)</p>
<p>使用提供的聚合表达式查询对象。</p>
<p>表达式可以是简单的值、对模型（或任何关联模型）上的字段的引用或者聚合表达式（平均值、总和等）。</p>
<p>annotate()的每个参数都是一个annotation，它将添加到返回的QuerySet每个对象中。</p>
<p>关键字参数指定的Annotation将使用关键字作为Annotation 的别名。 匿名参数的别名将基于聚合函数的名称和模型的字段生成。 只有引用单个字段的聚合表达式才可以使用匿名参数。 其它所有形式都必须用关键字参数。</p>
<p>例如，如果正在操作一个Blog列表，你可能想知道每个Blog有多少Entry：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from django.db.models import Count</span><br><span class="line">&gt;&gt;&gt; q &#x3D; Blog.objects.annotate(Count(&#39;entry&#39;))</span><br><span class="line"># The name of the first blog</span><br><span class="line">&gt;&gt;&gt; q[0].name</span><br><span class="line">&#39;Blogasaurus&#39;</span><br><span class="line"># The number of entries on the first blog</span><br><span class="line">&gt;&gt;&gt; q[0].entry__count</span><br><span class="line">42</span><br></pre></td></tr></table></figure>

<p>Blog模型本身没有定义<code>entry__count</code>属性，但是通过使用一个关键字参数来指定聚合函数，可以控制Annotation的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; q &#x3D; Blog.objects.annotate(number_of_entries&#x3D;Count(&#39;entry&#39;))</span><br><span class="line"># The number of entries on the first blog, using the name provided</span><br><span class="line">&gt;&gt;&gt; q[0].number_of_entries</span><br><span class="line">42</span><br></pre></td></tr></table></figure>

<h3 id="Q"><a href="#Q" class="headerlink" title="Q:"></a>Q:</h3><h4 id="update之后需要save"><a href="#update之后需要save" class="headerlink" title="update之后需要save?"></a>update之后需要save?</h4><h4 id="Select-related相当于预加载？"><a href="#Select-related相当于预加载？" class="headerlink" title="Select_related相当于预加载？"></a>Select_related相当于预加载？</h4><h4 id="下面是什么意思？"><a href="#下面是什么意思？" class="headerlink" title="下面是什么意思？"></a>下面是什么意思？</h4><p>考虑下面的情况，指定一个多值字段来排序（例如，一个ManyToManyField 字段或者ForeignKey 字段的反向关联）：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Event(Model):</span><br><span class="line">   parent &#x3D; models.ForeignKey(</span><br><span class="line">       &#39;self&#39;,</span><br><span class="line">       on_delete&#x3D;models.CASCADE,</span><br><span class="line">       related_name&#x3D;&#39;children&#39;,</span><br><span class="line">   )</span><br><span class="line">   date &#x3D; models.DateField()</span><br><span class="line"></span><br><span class="line">Event.objects.order_by(&#39;children__date&#39;)</span><br></pre></td></tr></table></figure>

<p>在这里，每个Event可能有多个排序数据；具有多个children的每个Event将被多次返回到<code>order_by()</code>创建的新的QuerySet中。 换句话说，用<code>order_by()</code>方法对QuerySet对象进行操作会返回一个扩大版的新QuerySet对象。因此，使用多值字段对结果进行排序时要格外小心</p>
<h4 id="在哪里指定http的方法？"><a href="#在哪里指定http的方法？" class="headerlink" title="在哪里指定http的方法？"></a>在哪里指定http的方法？</h4><h4 id="后续有时间看："><a href="#后续有时间看：" class="headerlink" title="后续有时间看："></a>后续有时间看：</h4><p>在values()子句中的聚合应用于相同values()子句中的其他参数之前。 如果需要按另一个值分组，请将其添加到较早的values()子句中。 像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from django.db.models import Count</span><br><span class="line">&gt;&gt;&gt; Blog.objects.values(&#39;author&#39;, entries&#x3D;Count(&#39;entry&#39;))</span><br><span class="line">&lt;QuerySet [&#123;&#39;author&#39;: 1, &#39;entries&#39;: 20&#125;, &#123;&#39;author&#39;: 1, &#39;entries&#39;: 13&#125;]&gt;</span><br><span class="line">&gt;&gt;&gt; Blog.objects.values(&#39;author&#39;).annotate(entries&#x3D;Count(&#39;entry&#39;))</span><br><span class="line">&lt;QuerySet [&#123;&#39;author&#39;: 1, &#39;entries&#39;: 33&#125;]&gt;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>如果你有一个字段foo是一个ForeignKey，默认的<code>foo_id</code>参数返回的字典中将有一个叫做foo 的键，因为这是保存实际值的那个隐藏的模型属性的名称。 当调用<code>foo_id</code>并传递字段的名称，传递foo 或values()都可以，得到的结果是相同的。像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Entry.objects.values()</span><br><span class="line">&lt;QuerySet [&#123;&#39;blog_id&#39;: 1, &#39;headline&#39;: &#39;First Entry&#39;, ...&#125;, ...]&gt;</span><br><span class="line">&gt;&gt;&gt; Entry.objects.values(&#39;blog&#39;)</span><br><span class="line">&lt;QuerySet [&#123;&#39;blog&#39;: 1&#125;, ...]&gt;</span><br><span class="line">&gt;&gt;&gt; Entry.objects.values(&#39;blog_id&#39;)</span><br><span class="line">&lt;QuerySet [&#123;&#39;blog_id&#39;: 1&#125;, ...]&gt;</span><br></pre></td></tr></table></figure>

<p>当values()与distinct()一起使用时，注意排序可能影响最终的结果。</p>
<p>如果values()子句位于extra()调用之后，extra()中的select参数定义的字段必须显式包含在values()调用中。 values( 调用后面的extra( 调用将忽略选择的额外的字段。</p>
<p>在values()之后调用only()和defer()不太合理，所以将引发一个NotImplementedError。</p>
<p>可以通过ManyToManyField、ForeignKey 和 OneToOneFiel 属性反向引用关联的模型的字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Blog.objects.values(&#39;name&#39;, &#39;entry__headline&#39;)</span><br><span class="line">&lt;QuerySet [&#123;&#39;name&#39;: &#39;My blog&#39;, &#39;entry__headline&#39;: &#39;An entry&#39;&#125;,</span><br><span class="line">     &#123;&#39;name&#39;: &#39;My blog&#39;, &#39;entry__headline&#39;: &#39;Another entry&#39;&#125;, ...]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="url分组转发"><a href="#url分组转发" class="headerlink" title="url分组转发"></a>url分组转发</h3><p>再看下面的URLconf：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    path(&#39;&lt;page_slug&gt;-&lt;page_id&gt;&#x2F;history&#x2F;&#39;, views.history),</span><br><span class="line">    path(&#39;&lt;page_slug&gt;-&lt;page_id&gt;&#x2F;edit&#x2F;&#39;, views.edit),</span><br><span class="line">    path(&#39;&lt;page_slug&gt;-&lt;page_id&gt;&#x2F;discuss&#x2F;&#39;, views.discuss),</span><br><span class="line">    path(&#39;&lt;page_slug&gt;-&lt;page_id&gt;&#x2F;permissions&#x2F;&#39;, views.permissions),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>上面的路由写得不好，我们可以改进它，只需要声明共同的路径前缀一次，并将后面的部分分组转发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import include, path</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    path(&#39;&lt;page_slug&gt;-&lt;page_id&gt;&#x2F;&#39;, include([</span><br><span class="line">        path(&#39;history&#x2F;&#39;, views.history),</span><br><span class="line">        path(&#39;edit&#x2F;&#39;, views.edit),</span><br><span class="line">        path(&#39;discuss&#x2F;&#39;, views.discuss),</span><br><span class="line">        path(&#39;permissions&#x2F;&#39;, views.permissions),</span><br><span class="line">    ])),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>这样就优雅多了，也清爽多了，但前提是你要理解这种做法。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Learning-Note/" rel="tag"># Learning Note</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/17/learning-git/" rel="prev" title="git">
      <i class="fa fa-chevron-left"></i> git
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Django-Model-Layer"><span class="nav-number">1.</span> <span class="nav-text">Django Model Layer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Important-Fields"><span class="nav-number">1.1.</span> <span class="nav-text">Important Fields</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Difference-between-null-and-blank"><span class="nav-number">1.2.</span> <span class="nav-text">The Difference between null and blank</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Index-Definition-and-Example"><span class="nav-number">1.3.</span> <span class="nav-text">Index Definition and Example</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Meta"><span class="nav-number">1.4.</span> <span class="nav-text">Meta</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#abstract"><span class="nav-number">1.4.1.</span> <span class="nav-text">abstract</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ordering"><span class="nav-number">1.4.2.</span> <span class="nav-text">ordering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unique-together"><span class="nav-number">1.4.3.</span> <span class="nav-text">unique_together</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#verbose-name"><span class="nav-number">1.4.4.</span> <span class="nav-text">verbose_name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Differences-between-related-nameand-related-query-name"><span class="nav-number">1.4.5.</span> <span class="nav-text">Differences between related_nameand related_query_name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E7%BB%A7%E6%89%BF"><span class="nav-number">1.4.6.</span> <span class="nav-text">多表继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Proxy-Model"><span class="nav-number">1.4.7.</span> <span class="nav-text">Proxy Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Save-Foreign-Key-and-Many-to-Many-Field"><span class="nav-number">1.4.8.</span> <span class="nav-text">Save Foreign Key and Many to Many Field</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.9.</span> <span class="nav-text">字段查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Q%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.10.</span> <span class="nav-text">使用Q对象进行复杂查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.4.11.</span> <span class="nav-text">批量更新对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QuerySet-API"><span class="nav-number">1.4.12.</span> <span class="nav-text">QuerySet API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#annotate"><span class="nav-number">1.4.12.1.</span> <span class="nav-text">annotate()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Q"><span class="nav-number">1.4.13.</span> <span class="nav-text">Q:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#update%E4%B9%8B%E5%90%8E%E9%9C%80%E8%A6%81save"><span class="nav-number">1.4.13.1.</span> <span class="nav-text">update之后需要save?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Select-related%E7%9B%B8%E5%BD%93%E4%BA%8E%E9%A2%84%E5%8A%A0%E8%BD%BD%EF%BC%9F"><span class="nav-number">1.4.13.2.</span> <span class="nav-text">Select_related相当于预加载？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F"><span class="nav-number">1.4.13.3.</span> <span class="nav-text">下面是什么意思？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E5%93%AA%E9%87%8C%E6%8C%87%E5%AE%9Ahttp%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="nav-number">1.4.13.4.</span> <span class="nav-text">在哪里指定http的方法？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8E%E7%BB%AD%E6%9C%89%E6%97%B6%E9%97%B4%E7%9C%8B%EF%BC%9A"><span class="nav-number">1.4.13.5.</span> <span class="nav-text">后续有时间看：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91"><span class="nav-number">1.4.14.</span> <span class="nav-text">url分组转发</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Boyang Gao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Boyang Gao</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
